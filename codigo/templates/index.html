<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‚ú® Gerenciador de Queries e Processos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#2563eb',
            secondary: '#16a34a'
          },
          animation: {
            gradient: 'gradient 8s ease infinite',
            fadeIn: 'fadeIn 0.8s ease forwards',
            glow: 'glow 2s ease-in-out infinite alternate'
          },
          keyframes: {
            gradient: {
              '0%, 100%': { backgroundPosition: '0% 50%' },
              '50%': { backgroundPosition: '100% 50%' }
            },
            fadeIn: {
              from: { opacity: '0', transform: 'translateY(10px)' },
              to: { opacity: '1', transform: 'translateY(0)' }
            },
            glow: {
              from: { textShadow: '0 0 10px #3b82f6' },
              to: { textShadow: '0 0 25px #60a5fa' }
            }
          }
        }
      }
    }
  </script>
</head>


<body class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-100 to-blue-200 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 bg-[length:200%_200%] animate-gradient text-gray-800 dark:text-gray-100 transition-colors duration-300 relative overflow-hidden">

<!-- üåô Alternar modo escuro (sempre vis√≠vel em todas as telas) -->
<button id="toggleDark"
  class="fixed top-5 right-5 z-[9999] backdrop-blur-md bg-white/70 dark:bg-gray-800 dark:text-gray-100 px-3 py-1 rounded-lg shadow text-sm hover:bg-gray-200 dark:hover:bg-gray-700 transition-all duration-300">
  üåô
</button>


  <!-- üîê Tela de Login -->
  <div id="loginScreen" class="flex items-center justify-center min-h-screen animate-fadeIn">
    <div class="backdrop-blur-md bg-white/80 dark:bg-gray-900/80 shadow-2xl rounded-3xl p-10 w-full max-w-md border border-white/30 dark:border-gray-700 transform transition-all duration-700 hover:scale-[1.02]">
      <h2 class="text-4xl font-extrabold text-center mb-8 text-primary dark:text-blue-400 animate-glow">‚ú® Acesso ao Sistema</h2>
      <form id="loginForm" class="space-y-5">
        <div>
          <label for="usuario" class="block font-medium mb-1">Usu√°rio</label>
          <input type="text" id="usuario" name="usuario" required
            class="w-full border border-gray-300 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:outline-none">
        </div>
        <div>
          <label for="senha" class="block font-medium mb-1">Senha</label>
          <input type="password" id="senha" name="senha" required
            class="w-full border border-gray-300 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:outline-none">
        </div>
        <button type="submit"
          class="w-full bg-gradient-to-r from-primary to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-2 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105">
          Entrar üöÄ
        </button>
      </form>
      <div id="loginMsg" class="mt-4 text-center text-sm"></div>
    </div>
  </div>

  <!-- üß≠ Tela de Menu Principal -->
  <div id="menuPrincipalScreen" class="hidden flex flex-col justify-center items-center min-h-screen animate-fadeIn">
    <h1 class="text-5xl font-extrabold text-primary dark:text-blue-400 mb-10 animate-glow text-center">Bem-vindo ao Sistema üí´</h1>
    <div class="flex flex-col gap-6">
      <button id="btnMenuQuery" class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-10 py-4 rounded-2xl shadow-xl hover:scale-105 hover:shadow-[0_0_20px_#2563eb] transition-all">
        üíæ Gerenciar Queries
      </button>
      <button id="btnMenuProcesso" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-10 py-4 rounded-2xl shadow-xl hover:scale-105 hover:shadow-[0_0_20px_#16a34a] transition-all">
        ‚öôÔ∏è Gerenciar Processos
      </button>
      <button id="btnSairMenuPrincipal" class="text-red-600 hover:underline mt-6">Sair</button>
    </div>
  </div>

  <!-- üß≠ Menu Superior -->
  <div id="menuScreen" class="hidden bg-white/80 dark:bg-gray-900/80 backdrop-blur-md shadow-lg p-6 flex flex-col items-center sticky top-0 z-50 transition-all duration-500 border-b border-white/30 dark:border-gray-700">
    <div class="flex gap-6 mb-3">
      <button id="btnQuery" class="bg-gradient-to-r from-blue-500 to-blue-700 text-white px-6 py-3 rounded-xl shadow-md hover:scale-105 hover:shadow-[0_0_25px_#2563eb] transition">üíæ Queries</button>
      <button id="btnProcesso" class="bg-gradient-to-r from-green-500 to-green-700 text-white px-6 py-3 rounded-xl shadow-md hover:scale-105 hover:shadow-[0_0_25px_#16a34a] transition">‚öôÔ∏è Processos</button>
    </div>
    <button id="logoutBtnMenu" class="text-red-600 hover:underline">Sair</button>
  </div>

<!-- üíª Conte√∫do Principal -->
<div id="mainScreen" class="hidden w-full max-w-[95vw] mx-auto py-10 px-6 animate-fadeIn">
  <h1 id="tituloTela" class="text-3xl font-bold text-gray-700 dark:text-gray-100 mb-6 text-center"></h1>
  <div id="mainContent" class="bg-white/80 dark:bg-gray-900/80 backdrop-blur-md p-6 rounded-2xl shadow-xl space-y-4 border border-white/20 dark:border-gray-700
      max-h-[85vh] overflow-y-auto w-full">
  </div>
</div>





  <script>
    // üåô Tema escuro com persist√™ncia
    const htmlEl = document.documentElement;
    const toggleBtn = document.getElementById("toggleDark");

    if (localStorage.getItem("tema") === "dark") {
      htmlEl.classList.add("dark");
    }

    toggleBtn.addEventListener("click", () => {
      htmlEl.classList.toggle("dark");
      const isDark = htmlEl.classList.contains("dark");
      localStorage.setItem("tema", isDark ? "dark" : "light");
    });

    // --- Restante do c√≥digo original ---

    const loginForm = document.getElementById('loginForm');
    const loginScreen = document.getElementById('loginScreen');
    const menuPrincipalScreen = document.getElementById('menuPrincipalScreen');
    const menuScreen = document.getElementById('menuScreen');
    const mainScreen = document.getElementById('mainScreen');
    const loginMsg = document.getElementById('loginMsg');
    const tituloTela = document.getElementById("tituloTela");
    const mainContent = document.getElementById("mainContent");

    // LOGIN
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      loginMsg.innerHTML = "";
      const usuario = document.getElementById("usuario").value.trim();
      const senha = document.getElementById("senha").value.trim();
      const res = await fetch("/api/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ usuario, senha }),
      });
      const json = await res.json();
      if (res.ok) {
        localStorage.setItem("logado", "true");
        loginMsg.innerHTML = `<p class='text-green-600'>${json.message}</p>`;
        setTimeout(() => {
          loginScreen.classList.add("hidden");
          menuPrincipalScreen.classList.remove("hidden");
        }, 500);
      } else {
        loginMsg.innerHTML = `<p class='text-red-600'>${json.error}</p>`;
      }
    });

    // MENU
    document.getElementById("btnMenuQuery").addEventListener("click", () => abrirTelaMenu("query"));
    document.getElementById("btnMenuProcesso").addEventListener("click", () => abrirTelaMenu("processo"));
    document.getElementById("btnQuery").addEventListener("click", () => abrirTela("query"));
    document.getElementById("btnProcesso").addEventListener("click", () => abrirTela("processo"));

    function abrirTelaMenu(tipo) {
      menuPrincipalScreen.classList.add("hidden");
      mainScreen.classList.remove("hidden");
      menuScreen.classList.remove("hidden");
      abrirTela(tipo);
    }

    document.getElementById("btnSairMenuPrincipal").addEventListener("click", async () => {
      await fetch("/api/logout", { method: "POST" });
      localStorage.removeItem("logado");
      menuPrincipalScreen.classList.add("hidden");
      loginScreen.classList.remove("hidden");
      loginForm.reset();
    });

    document.getElementById("logoutBtnMenu").addEventListener("click", async () => {
      await fetch("/api/logout", { method: "POST" });
      localStorage.removeItem("logado");
      menuScreen.classList.add("hidden");
      mainScreen.classList.add("hidden");
      loginScreen.classList.remove("hidden");
      loginForm.reset();
    });

    //if (localStorage.getItem("logado") === "true") {
    // loginScreen.classList.add("hidden");
    //  menuPrincipalScreen.classList.remove("hidden");
    //}


    // LISTA
    async function abrirTela(tipo) {
      tituloTela.textContent = tipo === "query" ? "Gerenciador de Queries üíæ" : "Gerenciador de Processos ‚öôÔ∏è";
      mainContent.innerHTML = `
        <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-2 animate-fadeIn">
          <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-100">Registros</h2>
          <input id="searchInput" type="text" placeholder="Pesquisar..."
            class="border border-gray-300 dark:border-gray-700 rounded-lg px-3 py-2 w-full md:w-1/3 focus:outline-none focus:ring-2 focus:ring-primary transition">
          <button id="btnNovo" class="bg-gradient-to-r from-primary to-blue-600 text-white px-4 py-2 rounded-lg hover:scale-105 hover:shadow-[0_0_15px_#2563eb] transition-all duration-300">
            ‚ûï Nova ${tipo === "query" ? "Query" : "Processo"}
          </button>
        </div>
        <div id="listaContainer" class="flex flex-col gap-4 animate-fadeIn">
          <p class="text-gray-500 text-center">Carregando...</p>
        </div>
      `;
      document.getElementById("btnNovo").addEventListener("click", () => abrirFormulario(tipo));
      await carregarLista(tipo);
    }

    // üîπ ABRIR ARQUIVO EXISTENTE
async function abrirArquivo(tipo, nomeArquivo) {
  const url = tipo === "query" 
    ? `/api/abrir_query/${encodeURIComponent(nomeArquivo)}`
    : `/api/abrir_processo/${encodeURIComponent(nomeArquivo)}`;

  try {
    const res = await fetch(url);
    const data = await res.json();
    if(!res.ok) { alert(data.error); return; }

    mainContent.innerHTML = `
      <button id="voltarLista" class="mb-4 text-primary hover:underline transition transform hover:scale-105">‚Üê Voltar</button>
      <div id="formContainer" class="opacity-0 transform translate-y-5 transition-all duration-500">
        ${tipo === "query" ? formQueryHTML() : formProcessoHTML()}
      </div>
    `;
    const formContainer = document.getElementById("formContainer");
    setTimeout(() => formContainer.classList.remove("opacity-0", "translate-y-5"), 50);
    document.getElementById("voltarLista").addEventListener("click", () => abrirTela(tipo));

    const formEl = tipo === "query" ? document.getElementById("queryForm") : document.getElementById("processoForm");

    // Preencher formul√°rio com os dados do arquivo
    for(const [key, val] of Object.entries(data)){
      if(key === "etapas" && tipo === "processo"){
        const etapasContainer = document.getElementById("etapasContainer");
        etapasContainer.innerHTML = "";
        val.forEach(etapa => {
          const div = document.createElement("div");
          div.className = "flex gap-2";
          div.innerHTML = `
            <input type="text" name="etapas[]" class="flex-1 border rounded px-3 py-2" value="${etapa}">
            <button type="button" class="bg-red-500 text-white px-3 rounded hover:bg-red-600 transition">‚úñ</button>
          `;
          div.querySelector("button").addEventListener("click", () => div.remove());
          etapasContainer.appendChild(div);
        });
      } else if(formEl[key]){
        formEl[key].value = val;
      }
    }

    attachFormEvents(tipo); // Reanexa eventos de submit
  } catch(err){
    console.error(err);
    alert("Erro ao abrir arquivo üò¢");
  }
}


    // --- üü© FLAGS DE AMBIENTE ---
    async function carregarLista(tipo) {
      const listaContainer = document.getElementById("listaContainer");
      const url = tipo === "query" ? "/api/consultar" : "/api/consultarp";

      try {
        const res = await fetch(url);
        const data = await res.json();
        listaContainer.innerHTML = "";

        if (!res.ok || !data.length) {
          listaContainer.innerHTML = `<p class='text-gray-500 text-center'>Nenhum registro encontrado.</p>`;
          return;
        }

        data.forEach((item, index) => {
  const card = document.createElement("div");
card.className = `
  relative bg-white/90 dark:bg-gray-800/80 backdrop-blur-md rounded-2xl shadow-md border border-white/30 dark:border-gray-700
  p-4 w-full max-w-[90%] mx-auto
  transform opacity-0 translate-y-5 transition-all duration-700
  hover:scale-[1.02] hover:shadow-xl hover:shadow-blue-200/30 dark:hover:shadow-blue-700/20
`;


  // --- Badge de ambiente ---
  let ambiente = (item.ambiente || "").toUpperCase();
  let badgeColor, emoji;
  switch (ambiente) {
    case "PRODUCAO": badgeColor = "bg-red-500"; emoji = "üß±"; break;
    case "HOMOLOGACAO": badgeColor = "bg-green-500"; emoji = "üß©"; break;
    case "DESENVOLVIMENTO": badgeColor = "bg-blue-500"; emoji = "üí°"; break;
    case "TESTE": badgeColor = "bg-yellow-500"; emoji = "üß™"; break;
    default: badgeColor = "bg-gray-400"; emoji = "üìÅ";
  }
  const badgeHTML = ambiente
    ? `<span class="absolute top-3 right-3 ${badgeColor} text-white text-xs font-semibold px-3 py-1 rounded-full shadow flex items-center gap-1">
        ${emoji} ${ambiente}
      </span>`
    : "";

  // --- Campos da query/processo ---
  const campos = Object.entries(item)
    .filter(([key]) => key.toLowerCase() !== "ambiente")
    .map(([key, val]) => `
      <p><span class="font-semibold text-gray-600 dark:text-gray-300">${key}:</span>
      <span class="text-gray-800 dark:text-gray-100">${Array.isArray(val) ? val.join(", ") : val}</span></p>
    `)
    .join("");

// --- Menu de a√ß√µes ---
const actionsHTML = `
  <div class="actionsMenu hidden mt-2 bg-white dark:bg-gray-800 shadow-lg rounded-lg py-1">
    <button class="editAction w-full text-left px-3 py-1 hover:bg-gray-100 dark:hover:bg-gray-700 transition">‚úèÔ∏è Editar</button>
    <button class="deleteAction w-full text-left px-3 py-1 hover:bg-red-500 hover:text-white transition">üóëÔ∏è Apagar</button>
  </div>
`;

card.innerHTML = badgeHTML + actionsHTML + campos;

const actionsMenu = card.querySelector(".actionsMenu");

  // --- Editar ---
  const editBtn = card.querySelector(".editAction");
  editBtn.addEventListener("click", () => {
    abrirFormularioComDados(tipo, item);
    actionsMenu.classList.add("hidden");
  });

  // --- Apagar ---
  const deleteBtn = card.querySelector(".deleteAction");
  deleteBtn.addEventListener("click", async (e) => {
    e.stopPropagation();
    if (!confirm("Deseja realmente apagar este arquivo?")) return;

    const arquivo = item.titulo.replace(/ /g, "_").toLowerCase() + ".yaml";
    const res = await fetch(`/api/apagar_query/${arquivo}`, { method: "DELETE" });
    const json = await res.json();

    if (res.ok) {
      alert("Arquivo apagado com sucesso!");
      carregarLista(tipo);
    } else {
      alert("Erro ao apagar: " + json.error);
    }
  });

  // --- Clique no card abre formul√°rio ---
  card.addEventListener("click", () => abrirFormularioComDados(tipo, item));

  listaContainer.appendChild(card);
  setTimeout(() => card.classList.remove("opacity-0", "translate-y-5"), index * 120);
});

      } catch (err) {
        console.error(err);
        listaContainer.innerHTML = `<p class='text-red-600 text-center'>Erro ao carregar registros üò¢</p>`;
      }
    }

    // FORMUL√ÅRIOS
    function abrirFormulario(tipo) {
      mainContent.innerHTML = `
        <button id="voltarLista" class="mb-4 text-primary hover:underline transition transform hover:scale-105">‚Üê Voltar</button>
        <div id="formContainer" class="opacity-0 transform translate-y-5 transition-all duration-500">
          ${tipo === "query" ? formQueryHTML() : formProcessoHTML()}
        </div>
      `;
      const formContainer = document.getElementById("formContainer");
      setTimeout(() => formContainer.classList.remove("opacity-0", "translate-y-5"), 50);
      document.getElementById("voltarLista").addEventListener("click", () => abrirTela(tipo));
      attachFormEvents(tipo);
    }

   
    async function abrirFormularioComDados(tipo, item) {
  // Cria overlay full-screen
  const overlay = document.createElement("div");
  overlay.id = "formOverlay";
  overlay.className = `
    fixed top-0 left-0 w-full h-full bg-black/30 dark:bg-black/40 z-50 flex justify-center items-start pt-24 overflow-y-auto
    opacity-0 scale-95 transition-all duration-300
  `;

  document.body.appendChild(overlay);
  setTimeout(() => overlay.classList.remove("opacity-0", "scale-95"), 50);

  // Cria card centralizado
const card = document.createElement("div");
card.className = `
  bg-white/90 dark:bg-gray-800/80 backdrop-blur-md rounded-2xl shadow-2xl border border-white/30 dark:border-gray-700
  p-6 w-[95vw] max-w-[95vw] mx-auto overflow-x-auto whitespace-pre-wrap animate-fadeIn
`;




  // T√≠tulo
  const titulo = document.createElement("h2");
  titulo.className = "text-3xl font-bold text-gray-800 dark:text-gray-100 text-center mb-6";
  titulo.textContent = item.titulo || "Sem t√≠tulo";
  card.appendChild(titulo);

  // Lista de campos
  const ul = document.createElement("ul");
  ul.className = "list-disc list-inside space-y-2 text-gray-700 dark:text-gray-200";
  Object.entries(item).forEach(([key, val]) => {
    if (key.toLowerCase() === "titulo") return;
    const li = document.createElement("li");
    li.innerHTML = `<span class="font-semibold capitalize">${key}:</span> ${
      Array.isArray(val)
        ? `<ul class="list-decimal list-inside ml-4 space-y-1">${val.map(v => `<li>${v}</li>`).join('')}</ul>`
        : val
    }`;
    ul.appendChild(li);
  });
  card.appendChild(ul);

  // Bot√µes de a√ß√£o
  const actions = document.createElement("div");
  actions.className = "mt-6 flex justify-end gap-3";

  const btnEditar = document.createElement("button");
  btnEditar.className = "bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition";
  btnEditar.textContent = "‚úèÔ∏è Editar";
  btnEditar.addEventListener("click", () => {
    overlay.remove();
    abrirFormulario(tipo);
  });

  const btnApagar = document.createElement("button");
  btnApagar.className = "bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition";
  btnApagar.textContent = "üóëÔ∏è Apagar";
  btnApagar.addEventListener("click", async () => {
    if (!confirm(`Deseja realmente apagar "${item.titulo}"?`)) return;
    const arquivo = item.titulo.replace(/ /g, "_").toLowerCase() + ".yaml";
    const res = await fetch(`/api/apagar_query/${arquivo}`, { method: "DELETE" });
    const json = await res.json();
    if (res.ok) {
      alert("Arquivo apagado com sucesso!");
      overlay.remove();
      abrirTela(tipo);
    } else {
      alert("Erro ao apagar: " + json.error);
    }
  });

  actions.appendChild(btnEditar);
  actions.appendChild(btnApagar);
  card.appendChild(actions);

  overlay.appendChild(card);

  // Fecha overlay ao clicar fora do card
  overlay.addEventListener("click", (e) => {
    if (e.target === overlay) overlay.remove();
  });
}




const formQueryHTML = () => `
  <form id="queryForm" class="space-y-4 animate-fadeIn">
    <!-- T√≠tulo -->
    <input type="text" name="titulo" placeholder="T√≠tulo" required
      class="w-full border rounded px-3 py-2">

    <!-- Query SQL -->
    <textarea name="query" placeholder="SQL" rows="5" required
      class="w-full border rounded px-3 py-2"></textarea>

    <!-- Motivo -->
    <input type="text" name="motivo" placeholder="Motivo" required
      class="w-full border rounded px-3 py-2">

    <!-- Ambiente -->
    <label class="block font-medium text-gray-700 dark:text-gray-200 mb-1">Ambiente</label>
    <select name="ambiente" required
      class="w-full border rounded px-3 py-2 bg-gray-50 dark:bg-gray-800 dark:text-gray-100">
      <option value="">Selecione o ambiente...</option>
      <option value="PRODUCAO">Produ√ß√£o</option>
      <option value="HOMOLOGACAO">Homologa√ß√£o</option>
    </select>

    <!-- Rollback -->
    <input type="text" name="rollback" placeholder="Rollback"
      class="w-full border rounded px-3 py-2">

    <!-- Autor -->
    <input type="text" name="autor" placeholder="Autor" required
      class="w-full border rounded px-3 py-2">

    <!-- Bot√£o de envio -->
    <button type="submit"
      class="bg-gradient-to-r from-primary to-blue-600 text-white w-full py-2 rounded-lg hover:scale-105 hover:shadow-lg transition">
      Salvar Query
    </button>
  </form>
`;


const formProcessoHTML = () => `
  <form id="processoForm" class="space-y-4 animate-fadeIn">
    <!-- T√≠tulo -->
    <input type="text" name="titulo" placeholder="T√≠tulo do processo" required
      class="w-full border rounded px-3 py-2">

    <!-- Autor -->
    <label class="block font-medium text-gray-700 dark:text-gray-200 mb-1">Autor</label>
    <input type="text" name="autor" placeholder="Nome do autor" required
      class="w-full border rounded px-3 py-2 bg-gray-50 dark:bg-gray-800 dark:text-gray-100">

    <!-- Servidor -->
    <label class="block font-medium text-gray-700 dark:text-gray-200 mb-1">Servidor</label>
    <select name="servidor" required
      class="w-full border rounded px-3 py-2 bg-gray-50 dark:bg-gray-800 dark:text-gray-100">
      <option value="">Selecione o servidor...</option>
      <option value="CTC1">CTC1</option>
      <option value="REAL">REAL</option>
      <option value="SQL1">SQL1</option>
      <option value="Venus">Venus</option>
      <option value="Kripton">Kripton</option>
      <option value="Miller">Miller</option>
      <option value="Plutao">Plut√£o</option>
      <option value="Azure">Azure</option>
      <option value="Saturno">Saturno</option>
    </select>

    <!-- Data de Execu√ß√£o -->
    <label class="block font-medium text-gray-700 dark:text-gray-200 mb-1">Data de execu√ß√£o</label>
    <input type="date" name="data_execucao" required
      class="w-full border rounded px-3 py-2 bg-gray-50 dark:bg-gray-800 dark:text-gray-100">

    <!-- Hor√°rio de Execu√ß√£o -->
    <label class="block font-medium text-gray-700 dark:text-gray-200 mb-1">Hor√°rio de execu√ß√£o</label>
    <input type="time" name="hora_execucao" required
      class="w-full border rounded px-3 py-2 bg-gray-50 dark:bg-gray-800 dark:text-gray-100">

    <!-- Etapas -->
    <div>
      <label class="block font-medium text-gray-700 dark:text-gray-200">Etapas</label>
      <div id="etapasContainer" class="space-y-2"></div>
      <button type="button" id="addEtapa"
        class="bg-gradient-to-r from-secondary to-green-600 text-white px-4 py-2 rounded-lg hover:scale-105 hover:shadow-md transition">
        ‚ûï Adicionar Etapa
      </button>
    </div>

    <!-- Bot√£o de envio -->
    <button type="submit"
      class="bg-gradient-to-r from-primary to-blue-600 text-white w-full py-2 rounded-lg hover:scale-105 hover:shadow-lg transition">
      Salvar Processo
    </button>
  </form>
`;




function attachFormEvents(tipo) {
  if (tipo === "query") {
    document.getElementById("queryForm").addEventListener("submit", async e => {
      e.preventDefault();

      // Pega os dados do formul√°rio
      const formData = Object.fromEntries(new FormData(e.target).entries());

      try {
        const res = await fetch("/api/salvar", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(formData)
        });
        const json = await res.json();

        if (res.ok) {
          alert(json.message);
          abrirTela("query"); // volta para a lista
        } else {
          alert(json.error);
        }
      } catch (err) {
        console.error(err);
        alert("Erro ao salvar query üò¢");
      }
    });
  } else {
    // Adiciona etapa dinamicamente
    const etapasContainer = document.getElementById("etapasContainer");
    document.getElementById("addEtapa").addEventListener("click", () => {
      const div = document.createElement("div");
      div.className = "flex gap-2";
      div.innerHTML = `
        <input type="text" name="etapas[]" placeholder="Descri√ß√£o da etapa" class="flex-1 border rounded px-3 py-2">
        <button type="button" class="bg-red-500 text-white px-3 rounded hover:bg-red-600 transition">‚úñ</button>
      `;
      div.querySelector("button").addEventListener("click", () => div.remove());
      etapasContainer.appendChild(div);
    });

    // Envio real do formul√°rio de processo
    document.getElementById("processoForm").addEventListener("submit", async e => {
      e.preventDefault();

      // Pega etapas como array
      const etapas = [...document.querySelectorAll("input[name='etapas[]']")].map(i => i.value);
      const formData = Object.fromEntries(new FormData(e.target).entries());
      formData.etapas = etapas;

      try {
        const res = await fetch("/api/salvarp", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(formData)
        });
        const json = await res.json();

        if (res.ok) {
          alert(json.message);
          abrirTela("processo"); // volta para a lista
        } else {
          alert(json.error);
        }
      } catch (err) {
        console.error(err);
        alert("Erro ao salvar processo üò¢");
      }
    });
  }
}

  </script>
</body>
</html>
